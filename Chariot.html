<!DOCTYPE html>
<html>
<head><title>戰 車</title></head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://jyunming-chen.github.io/tutsplus/js/KeyboardState.js"></script>


<style>
  body {
    overflow: hidden
  }
</style>

<body>


<script>
var renderer, camera, controls, scene, keyboard = new KeyboardState();
var Chariot;
var base, turret, turn, cannon;

init();
animate();


function init() {

  renderer = new THREE.WebGLRenderer({
	  antialias: true
	});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x888888);
  document.body.appendChild(renderer.domElement);

  camera = new THREE.PerspectiveCamera(100, window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.y = 30;
  camera.position.z = 50;  // important

  controls = new THREE.OrbitControls(camera, renderer.domElement);

  scene = new THREE.Scene();

  let axes = new THREE.AxisHelper (100);
  scene.add (axes);

  var gridXZ = new THREE.GridHelper(100, 10, 'red', 'white');
  scene.add(gridXZ);

  Chariot = buildAou();
  scene.add (Chariot);

  var aou2 = Chariot.clone();
  aou2.rotation.y = Math.PI/6;
  aou2.position.set (10,0,20);
  //scene.add (aou2);

}

function animate() {
  keyboard.update();
  if(keyboard.down("W") || keyboard.pressed("W")) Chariot.position.z += 1;
  else if(keyboard.down("S") || keyboard.pressed("S")) Chariot.position.z -= 1;
  else if(keyboard.down("A") || keyboard.pressed("A")) Chariot.position.x += 1;
  else if(keyboard.down("D") || keyboard.pressed("D")) Chariot.position.x -= 1;
  else if(keyboard.down("K") || keyboard.pressed("K")) turret.rotation.y += .01;
  else if(keyboard.down(";") || keyboard.pressed(";")) turret.rotation.y -= .01;
  else if(keyboard.down("O") || keyboard.pressed("O")) turn.rotation.x -= .01;
  else if(keyboard.down("L") || keyboard.pressed("L")) turn.rotation.x += .01;
  controls.update();
  renderer.render (scene, camera);
  requestAnimationFrame (animate);
}

function buildAou () {

  var aou = new THREE.Object3D();

  var normalMat = new THREE.MeshNormalMaterial();
  base = new THREE.Mesh( new THREE.BoxGeometry (20,10,40), normalMat );
  turret = new THREE.Mesh( new THREE.CylinderBufferGeometry( 10, 10, 10, 32 ), normalMat );
  turn = new THREE.Mesh( new THREE.CylinderBufferGeometry( 1.5, 1.5, 10, 32 ), normalMat );
  cannon = new THREE.Mesh( new THREE.CylinderBufferGeometry( 1.5, 1.5, 10, 32 ), normalMat );


  base.position.y = 5;
  turret.position.set(0, 10, 10);
  turn.rotation.z = Math.PI/2;
  turn.position.set(0, 0, 10);
  cannon.rotation.x = Math.PI/2;
  cannon.position.set(0, 0, 5);


  aou.add (base);
  base.add (turret);
  turret.add (turn);
  turn.add (cannon);

  return aou;
}



</script>

</body>
</html>
